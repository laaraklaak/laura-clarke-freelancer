<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOCU-HUB SERVICES | Laura Clarke</title>
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- 3. Premium Google Font ("Inter") -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* 4. Use the "Inter" font for a sleek, modern look */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        
        /* 5. Custom Color Palette */
        .hero-bg {
            background-color: #F8F9FA;
            background-image: linear-gradient(to bottom right, #F8F9FA, #F1F5F9);
        }
        .brand-green {
            color: #16A34A; /* Primary Accent Color */
        }
        .brand-green-bg {
            background-color: #16A34A;
        }
        .brand-green-bg-hover:hover {
            background-color: #148C40;
        }
        .brand-dark-green {
            color: #2F4F4F; /* Professional Anchor Color */
        }
        .brand-dark-green-bg {
            background-color: #2F4F4F;
        }
        .brand-outline-btn {
            border: 2px solid #16A34A;
            color: #16A34A;
            transition: all 0.3s ease;
        }
        .brand-outline-btn:hover {
            background-color: #16A34A;
            color: #FFFFFF;
        }
        /* Review and Solution Card Styling */
        .review-card, .solution-card {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        .solution-card {
            position: relative;
            padding-left: 5rem;
        }
        .solution-card:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            transform: translateY(-3px);
            border-color: #16A34A;
        }
        .step-number {
            position: absolute;
            left: 1rem;
            top: 1.5rem;
            height: 2.5rem;
            width: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: #16A34A;
            color: white;
            font-weight: 800;
            font-size: 1.25rem;
        }
        /* Animation Classes */
        .scroll-reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.7s ease-out, transform 0.7s ease-out;
        }
        .scroll-reveal-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Styling for the Scroll-to-Agree box */
        #legal-terms-box {
            height: 12rem; /* Fixed height for scrolling */
            overflow-y: scroll;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            padding: 1rem;
            font-size: 0.875rem;
            line-height: 1.4;
            color: #4b5563;
        }
        /* Custom disabled state for button */
        #submit-request-btn:disabled {
            background-color: #9CA3AF;
            cursor: not-allowed;
            box-shadow: none;
        }
        .status-success {
            background-color: #d1fae5;
            color: #065F46;
            padding: 0.5rem;
            border-radius: 0.375rem;
            font-weight: bold;
        }
    </style>
</head>
<body class="text-gray-800 antialiased bg-gray-50">

    <!-- Header / Navigation -->
    <header class="bg-white/95 backdrop-blur-sm shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="text-2xl font-bold brand-dark-green">DOCU-HUB SERVICES</div>
            <div class="hidden md:flex space-x-6">
                <a href="#about" class="text-gray-600 hover:text-gray-900 font-medium transition-colors duration-300">About</a>
                <a href="#services" class="text-gray-600 hover:text-gray-900 font-medium transition-colors duration-300">Solutions</a>
                <a href="#portfolio" class="text-gray-600 hover:text-gray-900 font-medium transition-colors duration-300">Experience</a>
                <a href="#request-form" class="text-gray-600 hover:text-gray-900 font-medium transition-colors duration-300">Request Project</a>
            </div>
            <div class="md:hidden">
                <button class="text-gray-600 hover:text-gray-900">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </nav>
    </header>

    <!-- Hero Section -->
    <section id="about" class="hero-bg py-24 md:py-32 overflow-hidden">
        <div class="container mx-auto px-6 flex flex-col md:flex-row items-center">
            <div class="md:w-3/5 text-center md:text-left mb-12 md:mb-0">
                <h1 class="text-5xl md:text-6xl font-extrabold text-gray-900 mb-4 tracking-tight">Laura Clarke</h1>
                <h2 class="text-2xl md:text-3xl font-light brand-dark-green mb-8">DOCU-HUB OPERATIONS SERVICES | Compliance & Systems Expert</h2>
                <p class="text-lg text-gray-600 mb-10 max-w-xl">
                    I offer dedicated, project-based administrative solutions. I leverage 15+ years of high-compliance experience to eliminate administrative risk, **bringing you peace of mind** knowing your complex documents and statutory submissions are handled with absolute authority and accuracy.
                </p>
                <div class="flex justify-center md:justify-start space-x-4">
                    <a href="#services" class="brand-green-bg brand-green-bg-hover text-white font-bold py-3 px-8 rounded-lg shadow-lg transform hover:scale-105 transition duration-300">
                        View Solutions
                    </a>
                    <a href="laura-clarke-cv-public.pdf" target="_blank" class="brand-outline-btn font-bold py-3 px-8 rounded-lg shadow-lg transform hover:scale-105 transition duration-300">
                        Download CV (PDF)
                    </a>
                </div>
            </div>
            <div class="md:w-2/5 flex justify-center">
                <img src="images/profile_photo.jpg" onerror="this.onerror=null; this.src='https://placehold.co/384x384/2F4F4F/FFFFFF?text=LC+Photo'" alt="Laura Clarke" class="rounded-full w-72 h-72 md:w-96 md:h-96 object-cover border-8 border-white shadow-lg" style="box-shadow: 0 10px 25px -5px rgba(22, 163, 74, 0.1), 0 10px 10px -5px rgba(22, 163, 74, 0.04);">
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="py-20 bg-white">
        <div class="container mx-auto px-6">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">How I Deliver Peace of Mind</h2>
                <p class="text-xl text-gray-600 max-w-2xl mx-auto">I specialize in **Digital Compliance & Submission**â€”solving your most frustrating administrative challenges.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                
                <!-- 1. TAJ & Long Line Solution (STEP 1) -->
                <div class="solution-card p-6 rounded-xl">
                    <div class="step-number">1</div>
                    <div class="flex items-center mb-3 ml-4">
                        <i class="fas fa-file-invoice text-2xl brand-green mr-3"></i>
                        <h3 class="text-xl font-bold text-gray-900">TAJ & Tax Portal Submissions</h3>
                    </div>
                    <p class="text-gray-700 mb-2 ml-4">**THE PAIN:** Spending hours in line or getting rejected due to online errors on tax payments or filings.</p>
                    <p class="font-semibold text-gray-800 ml-4">**THE SOLUTION:** Guaranteed error-free filing and timely payment of Property Tax and other statutory obligations via the TAJ portal.</p>
                </div>

                <!-- 2. PICA Passport & Citizenship Applications (STEP 2) -->
                <div class="solution-card p-6 rounded-xl">
                    <div class="step-number">2</div>
                    <div class="flex items-center mb-3 ml-4">
                        <i class="fas fa-passport text-2xl brand-green mr-3"></i>
                        <h3 class="text-xl font-bold text-gray-900">PICA Passport & Citizenship Applications</h3>
                    </div>
                    <p class="text-gray-700 mb-2 ml-4">**THE PAIN:** The PICA online application process is notoriously complex, leading to delays and costly rejections on passports or citizenship forms.</p>
                    <p class="font-semibold text-gray-800 ml-4">**THE SOLUTION:** Meticulous completion and submission of all PICA applications, ensuring 100% document compliance to secure approval the first time.</p>
                </div>

                <!-- 3. Motor Vehicle & Licensing Solution (STEP 3) -->
                <div class="solution-card p-6 rounded-xl">
                    <div class="step-number">3</div>
                    <div class="flex items-center mb-3 ml-4">
                        <i class="fas fa-car-side text-2xl brand-green mr-3"></i>
                        <h3 class="text-xl font-bold text-gray-900">Motor Vehicle License & Renewal</h3>
                    </div>
                    <p class="text-gray-700 mb-2 ml-4">**THE PAIN:** Hassle and lost time renewing licenses, paying traffic tickets, or completing other motor vehicle payments online.</p>
                    <p class="font-semibold text-gray-800 ml-4">**THE SOLUTION:** Fast, accurate, and completely online handling of all necessary motor vehicle payments and licensing procedures.</p>
                </div>

                <!-- 4. Online Banking & Complex Apps Solution (STEP 4) -->
                <div class="solution-card p-6 rounded-xl">
                    <div class="step-number">4</div>
                    <div class="flex items-center mb-3 ml-4">
                        <i class="fas fa-lock text-2xl brand-green mr-3"></i>
                        <h3 class="text-xl font-bold text-gray-900">Sensitive Financial Applications</h3>
                    </h3>
                    <p class="text-gray-700 mb-2 ml-4">**THE PAIN:** Older family members or individuals struggle with new online banking, loan, or complex visa applications.</p>
                    <p class="font-semibold text-gray-800 ml-4">**THE SOLUTION:** Secure, error-free completion of complex banking, loan, or visa applications, ensuring all supporting documents are correctly compiled and vetted for submission.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- DPA Compliant Project Request Form -->
    <section id="request-form" class="py-20 bg-gray-50 border-t border-gray-200">
        <div class="container mx-auto px-6 max-w-2xl">
            <div class="text-center mb-10 scroll-reveal">
                <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">Request Your Project Quote</h2>
                <p class="text-lg text-gray-600">Start the process by telling me about the administrative challenge you need solved.</p>
            </div>

            <form id="dpa-compliance-form" class="bg-white p-8 rounded-xl shadow-xl scroll-reveal">
                <div class="space-y-6">
                    <!-- Basic Contact Fields -->
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">Your Full Name</label>
                        <input type="text" id="name" name="name" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-brand-green focus:border-brand-green">
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                        <input type="email" id="email" name="email" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-brand-green focus:border-brand-green">
                    </div>
                    <div>
                        <label for="service" class="block text-sm font-medium text-gray-700">Type of Service Needed (e.g., PICA, MV Renewal, Tax Filing)</label>
                        <textarea id="service" name="service" rows="3" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:ring-brand-green focus:border-brand-green"></textarea>
                    </div>

                    <!-- DPA Compliance Section (Critical) -->
                    <div class="pt-6 border-t border-gray-200">
                        <h3 class="text-lg font-bold brand-dark-green mb-3">Data Protection Agreement (DPA) Consent</h3>
                        
                        <!-- Layer 1: Progressive Disclosure Summary -->
                        <div class="bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 p-4 mb-4" role="alert">
                            <p class="font-semibold text-sm">Mandatory DPA Consent Summary</p>
                            <p class="text-xs mt-1">
                                I authorize DOCU-HUB SERVICES to collect, process, and securely use my submitted personal data (TRN, ID #, Address) **only for the sole purpose of completing the specific administrative service requested in this form.**
                            </p>
                        </div>

                        <!-- Layer 2: Scroll-to-Agree Mechanism -->
                        <p class="text-xs font-semibold text-gray-600 mb-2">Review Full Terms (Scroll to bottom to enable consent)</p>
                        <div id="legal-terms-box" class="mb-4">
                            <!-- Full Legal Terms (Simulated Content) -->
                            <p class="font-bold mb-1">DOCU-HUB SERVICES Full Terms of Service (Version 1.0 - Nov 2025)</p>
                            <p>This Service Agreement governs the relationship between Laura Clarke (DOCU-HUB SERVICES) and the Client. By consenting, the Client agrees to the terms outlined below, affirming compliance with the Jamaica Data Protection Act (DPA).</p>
                            
                            <ol class="list-decimal ml-4 mt-2 space-y-2">
                                <li>**Data Processing Consent (DPA):** The Client grants explicit, unequivocal consent for DOCU-HUB SERVICES to act as a data processor for the sole purpose of fulfilling the contracted service (e.g., submitting a PICA application or paying a specific tax). No data will be shared with unauthorized third parties.</li>
                                <li>**Data Security:** All personal data (TRN, ID, banking info) will be handled in a secure, encrypted environment and purged from internal systems within 90 days of project completion, unless legally required otherwise.</li>
                                <li>**Bearer Authorization:** The Client confirms they are legally authorized to grant DOCU-HUB SERVICES (Laura Clarke) access to the required government/financial portal for submission.</li>
                                <li>**Liability & Guarantee:** DOCU-HUB SERVICES guarantees the accuracy of data entry and timely submission. Liability is limited to the cost of the service fee. The client is responsible for providing accurate source documentation.</li>
                                <li>**Fee Structure:** All projects are quoted on a fixed-fee basis, payable in JMD via bank transfer prior to submission.</li>
                                <!-- This is the very bottom line to prove scrolling -->
                                <li><span id="end-of-terms" class="font-bold text-red-600">END OF TERMS V1.0 - Scroll complete.</span></li>
                            </ol>
                            <!-- END Full Legal Terms -->
                        </div>

                        <!-- Mandatory Checkbox (Click-Wrap Agreement) -->
                        <div class="flex items-start">
                            <input id="dpa-consent-checkbox" type="checkbox" required class="mt-1 h-5 w-5 text-brand-green border-gray-300 rounded focus:ring-brand-green" disabled>
                            <label for="dpa-consent-checkbox" class="ml-3 text-sm text-gray-700">
                                **I confirm I have read, understand, and agree to the Terms of Service and the mandatory Data Protection Consent** for this specific service.
                            </label>
                        </div>
                    </div>

                    <!-- Submission Button -->
                    <button id="submit-request-btn" type="submit" disabled class="w-full brand-green-bg brand-green-bg-hover text-white font-bold py-3 px-8 rounded-lg shadow-xl transform transition duration-300 mt-6">
                        Submit Project Request (Consent Required)
                    </button>
                    <p id="status-message" class="text-center text-sm text-red-500 mt-3 hidden">Please read the terms and agree to proceed.</p>
                </div>
            </form>
        </div>
    </section>

    <!-- DPA Audit Log Section (Internal Only - Must be hidden from clients) -->
    <!-- The 'hidden' class is removed by JS when the authenticated user (you) clicks the toggle button -->
    <section id="audit-log" class="py-20 bg-gray-100 border-t border-gray-300 hidden">
        <div class="container mx-auto px-6 max-w-4xl">
            <h2 class="text-3xl font-bold text-gray-900 mb-6 brand-dark-green">DPA Consent & Project Inbox (Internal Log)</h2>
            <p class="text-sm text-red-700 bg-red-100 p-3 rounded-lg mb-4 font-semibold">
                WARNING: This section displays client data and is for the business owner's audit purposes only.
            </p>
            <div id="audit-log-data">
                <p class="text-center py-10 text-gray-500">Awaiting authenticated access...</p>
            </div>
        </div>
    </section>
    
    <!-- Experience, Reviews, Footer (Existing Content) -->
    <section id="portfolio" class="py-24 bg-gray-50">
        <!-- ... Existing Experience and Review Content ... -->
        <div class="container mx-auto px-6">
            
            <!-- Section Heading -->
            <div class="text-center mb-16 scroll-reveal">
                <h2 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-4 tracking-tight">Experience & Proof of Competence</h2>
                <p class="text-xl text-gray-600 max-w-2xl mx-auto">
                    My service is backed by institutional experience in high-compliance, audited environments.
                </p>
            </div>

            <!-- Experience Content -->
            <div class="max-w-4xl mx-auto space-y-12 mb-20 scroll-reveal">
                
                <!-- Pillar 1: Financial Integrity & Auditing (NCB Focus) -->
                <div class="flex flex-col md:flex-row items-start space-y-4 md:space-y-0 md:space-x-8 p-6 bg-white rounded-xl shadow-md border-l-4 border-yellow-600">
                    <div class="flex-shrink-0 text-3xl text-yellow-600 mt-1"><i class="fas fa-sack-dollar"></i></div>
                    <div>
                        <h3 class="text-xl font-bold mb-2">Financial Integrity & Audit Readiness</h3>
                        <p class="text-gray-600">
                            My background as a Team Leader and Financial Officer at **NCB** instilled a non-negotiable standard for accurate financial processing and regulatory balancing. This expertise is applied to every client project, ensuring your personal or small business records are **clean, verified, and 100% ready for tax filing or external review**, protecting you from future audit complications.
                        </p>
                    </div>
                </div>

                <!-- Pillar 2: Operational Systems & Compliance (OEC Focus) -->
                <div class="flex flex-col md:flex-row items-start space-y-4 md:space-y-0 md:space-x-8 p-6 bg-white rounded-xl shadow-md border-l-4 border-blue-600">
                    <div class="flex-shrink-0 text-3xl text-blue-600 mt-1"><i class="fas fa-tasks"></i></div>
                    <div>
                        <h3 class="text-xl font-bold mb-2">Operational Systems & Compliance Management</h3>
                        <p class="text-gray-600">
                            The successful administration of complex, simultaneous exams at the **OEC** required strategic planning, meticulous logistical coordination, and absolute compliance enforcement. I use this operational mindset to design simple, scalable administrative systems for your home or business, guaranteeing that documentation is correctly organized from the start, avoiding clutter and compliance gaps.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Client Testimonials (Future Proofing) -->
            <div class="text-center mb-10 mt-16 scroll-reveal">
                 <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">Client Success Stories</h2>
                 <p class="text-lg text-gray-600 max-w-2xl mx-auto">See how I eliminate confusion and deliver guaranteed administrative peace of mind.</p>
             </div>
             <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto scroll-reveal">
                 <!-- Review 1 (Danielle) -->
                 <div class="review-card p-6 rounded-lg">
                     <p class="text-4xl mb-4 text-green-500"><i class="fas fa-quote-left"></i></p>
                     <p class="text-gray-700 italic mb-4">"Thanks for simplifying the passport application process, it's my first one and I didn't know where to start."</p>
                     <p class="font-bold text-gray-800">- Danielle</p>
                 </div>
                 <!-- Review 2 (Claude) -->
                 <div class="review-card p-6 rounded-lg">
                     <p class="text-4xl mb-4 text-green-500"><i class="fas fa-quote-left"></i></p>
                     <p class="text-gray-700 italic mb-4">"Laura helped renew my motor vehicle license online, which took the hassle out of joining long lines. I will certainly spread the word to my friends."</p>
                     <p class="font-bold text-gray-800">- Claude, Private Client</p>
                 </div>
                 <!-- Review 3 (S. Williams) -->
                 <div class="review-card p-6 rounded-lg">
                     <p class="text-4xl mb-4 text-green-500"><i class="fas fa-quote-left"></i></p>
                     <p class="text-gray-700 italic mb-4">"Outstanding. Navigated the online portal for me and avoided a major error. Highly recommend for any complex form submission."</p>
                     <p class="font-bold text-gray-800">- S. Williams, Individual Client</p>
                 </div>
             </div>
        </div>
    </section>
    
    <!-- Footer -->
    <footer id="contact" class="brand-dark-green-bg text-white py-20">
        <div class="container mx-auto px-6 text-center">
            <!-- Private Toggle Button -->
            <button id="toggle-audit-btn" class="text-sm text-gray-400 hover:text-white mb-8 transition-colors duration-300 hidden">
                [Access Internal Project Inbox]
            </button>
            
            <h2 class="text-4xl font-bold mb-4">Let's Connect</h2>
            <p class="text-xl text-gray-300 mb-10 max-w-xl mx-auto">
                I am available for project-based contracts in operations and administrative management.
            </p>
            <div class="flex flex-col md:flex-row justify-center space-y-4 md:space-y-0 md:space-x-6">
                <a href="mailto:lauraclarke.jw@gmail.com" class="text-lg bg-white/10 border border-white/20 font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-white/20 transition duration-300 inline-flex items-center justify-center">
                    <i class="fas fa-envelope mr-3"></i> Email Me
                </a>
                <a href="https://www.linkedin.com/in/lauraclarke-freelancer/" target="_blank" class="text-lg bg-white/10 border border-white/20 font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-white/20 transition duration-300 inline-flex items-center justify-center">
                    <i class="fab fa-linkedin mr-3"></i> LinkedIn
                </a>
            </div>
            <p class="text-gray-400 mt-16 text-sm">
                &copy; 2025 Laura Clarke. All rights reserved.
            </p>
        </div>
    </footer>

    <!-- 8. Firebase & JavaScript for DPA Compliance and Animations -->
    <script type="module">
        // --- FIREBASE IMPORTS ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, setLogLevel, collection, onSnapshot, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Disable verbose logging for production environment, but keep 'Debug' here for setup verification
        setLogLevel('Debug');

        // Global Canvas Variables (Required)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db;
        let auth;
        let userId = 'anonymous'; // Will be updated on sign-in
        const toggleAuditBtn = document.getElementById('toggle-audit-btn');


        // --- FIREBASE INITIALIZATION & AUTHENTICATION ---
        async function initializeFirebase() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase config is missing.");
                    return;
                }
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Sign in using provided custom token or anonymously
                if (initialAuthToken) {
                    // This is the preferred sign-in method for the platform
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    // Fallback to anonymous sign-in if token is missing
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log(`Firebase authenticated. User ID: ${userId}`);
                        // Show the private access button
                        toggleAuditBtn.classList.remove('hidden'); 
                        // Start listening to the log once authenticated
                        startAuditLogListener(); 
                    } else {
                        console.log("User signed out or anonymous.");
                        toggleAuditBtn.classList.add('hidden'); 
                    }
                });

            } catch (error) {
                console.error("Error initializing Firebase or signing in:", error);
            }
        }
        
        // --- DPA COMPLIANCE LOG STORAGE FUNCTION ---
        async function saveComplianceLog(logData) {
            if (!db || !userId || userId === 'anonymous') {
                console.error("Database or User ID is not ready. Cannot save log.");
                // Simulate success instantly if DB is not ready, BUT IT SHOULD BE READY
                // We return failure here to reflect the real-world error
                return false; 
            }

            // Define the collection path for private compliance logs
            // Path: /artifacts/{appId}/users/{userId}/dpa_compliance_logs/{timestamp}
            const collectionPath = `/artifacts/${appId}/users/${userId}/dpa_compliance_logs`;
            const docId = new Date().getTime().toString(); // Use timestamp as unique Document ID

            try {
                const docRef = doc(db, collectionPath, docId);
                await setDoc(docRef, logData);
                console.log(`DPA Compliance Log saved successfully to Firestore. Document ID: ${docId}`);
                return true; // Return success status
            } catch (error) {
                // THIS ERROR IS THE SECURITY RULE VIOLATION (PERMISSION DENIED)
                console.error("Error saving compliance log (PERMISSION DENIED expected if rules not set):", error);
                // The form is stuck processing because of this failure.
                return false; 
            }
        }

        // --- MAIN FORM LOGIC ---
        const SERVICE_AGREEMENT_VERSION = "1.0";
        const SUBMISSION_METHOD = "Click-wrap acceptance via form checkbox";

        const form = document.getElementById('dpa-compliance-form');
        const termsBox = document.getElementById('legal-terms-box');
        const consentCheckbox = document.getElementById('dpa-consent-checkbox');
        const submitButton = document.getElementById('submit-request-btn');
        const statusMessage = document.getElementById('status-message');
        
        let hasScrolledToBottom = false;

        function checkScroll() {
            if (termsBox.scrollHeight - termsBox.clientHeight <= termsBox.scrollTop + 1) {
                if (!hasScrolledToBottom) {
                    hasScrolledToBottom = true;
                    consentCheckbox.disabled = false;
                    statusMessage.classList.add('hidden');
                    updateSubmitButtonState();
                }
            }
        }
        
        function updateSubmitButtonState() {
            const isReadyToSubmit = hasScrolledToBottom && consentCheckbox.checked;
            submitButton.disabled = !isReadyToSubmit;
            if (!isReadyToSubmit && hasScrolledToBottom) {
                 statusMessage.classList.remove('hidden');
                 statusMessage.textContent = "Please check the box to agree to the Terms of Service.";
            } else {
                statusMessage.classList.add('hidden');
            }
        }

        // --- Event Listeners ---
        termsBox.addEventListener('scroll', checkScroll);
        consentCheckbox.addEventListener('change', updateSubmitButtonState);
        
        // Listener for the private access button
        toggleAuditBtn.addEventListener('click', function() {
            const auditLogSection = document.getElementById('audit-log');
            if (auditLogSection.classList.contains('hidden')) {
                auditLogSection.classList.remove('hidden');
                toggleAuditBtn.textContent = "[Hide Project Inbox]";
            } else {
                auditLogSection.classList.add('hidden');
                toggleAuditBtn.textContent = "[Access Internal Project Inbox]";
            }
        });


        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            submitButton.disabled = true; // Disable button immediately
            submitButton.textContent = "Processing...";

            // We proceed with submission even if auth is not fully ready, but the save function will fail
            const clientIp = '10.0.0.1'; 
            
            const complianceLog = {
                consent_datetime: new Date().toISOString(),
                method: SUBMISSION_METHOD,
                service_version: SERVICE_AGREEMENT_VERSION,
                client_ip: clientIp,
                client_name: document.getElementById('name').value,
                client_email: document.getElementById('email').value,
                service_requested: document.getElementById('service').value,
                admin_user_id: userId 
            };

            const saveSuccess = await saveComplianceLog(complianceLog);

            // --- User Feedback ---
            if (saveSuccess) {
                submitButton.textContent = "Request Sent & Consent Logged Successfully!";
                submitButton.classList.remove('brand-green-bg', 'bg-red-500');
                submitButton.classList.add('bg-green-600', 'status-success');
                form.reset(); // Clear the form after success
            } else {
                // If the save fails (due to security rule), display the error clearly
                submitButton.textContent = "ERROR: Submission Failed (Check Admin Login & Rules)";
                submitButton.classList.remove('brand-green-bg', 'bg-green-600');
                submitButton.classList.add('bg-red-500');
                submitButton.disabled = false; // Re-enable for troubleshooting
            }
        });

        // Initialize Firebase and the form state
        initializeFirebase();
        updateSubmitButtonState();


        // --- Existing JavaScript for Animations ---
        document.addEventListener('DOMContentLoaded', () => {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('scroll-reveal-visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, {
                threshold: 0.1
            });

            const elements = document.querySelectorAll('.scroll-reveal');
            elements.forEach(el => {
                observer.observe(el);
            });
        });

        // --- Added: LIVE AUDIT LOG VIEWER ---
        const auditLogContainer = document.getElementById('audit-log-data');

        function renderComplianceLogs(logs) {
            if (!auditLogContainer) return;
            
            let html = '<table class="min-w-full divide-y divide-gray-200 shadow-md rounded-lg overflow-hidden">';
            html += '<thead class="bg-gray-100">';
            html += '<tr><th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date/Time</th>';
            html += '<th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Client/Service</th>';
            html += '<th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Consent Ver.</th></tr>';
            html += '</thead><tbody class="bg-white divide-y divide-gray-200">';

            if (logs.length === 0) {
                html += '<tr><td colspan="3" class="px-3 py-4 text-center text-gray-500">No consent agreements logged yet.</td></tr>';
            } else {
                logs.forEach(log => {
                    const date = new Date(log.consent_datetime).toLocaleString('en-JM', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                    html += `<tr>
                        <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900">${date}</td>
                        <td class="px-3 py-2 whitespace-nowrap text-xs text-gray-600">
                            <div class="font-bold">${log.client_name} (${log.client_email})</div>
                            <div>Needs: ${log.service_requested.substring(0, 30)}...</div>
                        </td>
                        <td class="px-3 py-2 whitespace-nowrap text-sm text-green-600 font-bold">V${log.service_version}</td>
                    </tr>`;
                });
            }

            html += '</tbody></table>';
            auditLogContainer.innerHTML = html;
        }

        // --- Data Retrieval for Live Audit Log (Operational View) ---
        function startAuditLogListener() {
            // Check if Firestore is initialized and authenticated
            if (!db || !userId || userId === 'anonymous') {
                 // Try again in 500ms if not ready
                 setTimeout(startAuditLogListener, 500); 
                 return;
            }
            
            const collectionPath = `/artifacts/${appId}/users/${userId}/dpa_compliance_logs`;
            const logsCollection = collection(db, collectionPath);
            
            // Create a query to get the 10 most recent logs
            const q = query(logsCollection, orderBy("consent_datetime", "desc"), limit(10));
            
            // Set up the real-time listener
            onSnapshot(q, (snapshot) => {
                const logs = [];
                snapshot.forEach(doc => {
                    logs.push(doc.data());
                });
                renderComplianceLogs(logs); // Render the data to the UI
            }, (error) => {
                console.error("Error listening to compliance logs:", error);
                auditLogContainer.innerHTML = '<p class="text-red-500 text-center">Error loading audit logs.</p>';
            });
        }
        
        // Start the listener after Firebase initialization
        initializeFirebase();

    </script>

</body>
</html>
